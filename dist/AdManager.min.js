/*!
 * admanager - A JavaScipt library for interacting with Google DFP.
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/AdManager
 * @version 0.6.4
 */

!function(e,t){"use strict";"function"==typeof define&&define.amd?define("src/Util",["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):(e.AdManager=e.AdManager||{},e.AdManager.Util=t(e.jQuery))}(window,function(e){"use strict";function t(t,n){var i=[];return e.grep(t,function(t){-1===e.inArray(t,n)&&i.push(t)}),i}function n(t,n){return t=e.grep(t,function(e,t){return t!==n})}return{difference:t,removeByKey:n}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("src/Config",["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):(e.AdManager=e.AdManager||{},e.AdManager.Config=t(e.jQuery))}(window,function(e){"use strict";function t(t){e(document).on("AdManager:importConfig",a),e.event.trigger("AdManager:importConfig",t)}function n(e,t){return r(d,e,t)}function i(e){return e=e||!1,e?o(d,e):d}function r(e,t,n){return"string"==typeof t&&(t=t.split(".")),t.length>1?r(e[t.shift()],t,n):e[t[0]]=n,e}function o(e,t){return"string"==typeof t&&(t=t.split(".")),t.length>1?o(e[t.shift()],t):t[0]in e?e[t[0]]:null}function a(t,n){return d=e.extend(g,d,n)}var d={},g={account:null,autoload:!0,clientType:!1,context:"body",enabled:!0,lazy:!1,lazyConfig:{fetchMarginPercent:300,renderMarginPercent:150,mobileScaling:2},insertionEnabled:!1,insertion:{pxBetweenUnits:0,adHeightLimit:1e3,uniqueClass:"",childOffset:0,insertExclusion:["img","iframe","video","audio",".video",".audio","[data-ad-unit]"]},usePlaceholders:!1,inventory:[],targeting:[]};return{init:t,set:n,get:i}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("src/Inventory",["jquery","./Util","./Config"],function(n,i,r){return t(e,n,i,r)}):"object"==typeof exports?module.exports=t(e,require("jquery"),require("./Util"),require("./Config")):(e.AdManager=e.AdManager||{},e.AdManager.Inventory=t(e,e.jQuery,e.AdManager.Util,e.AdManager.Config))}(window,function(e,t,n,i){"use strict";function r(){return a(o(i.get("inventory")))}function o(e){for(var t=0;t<e.length;t++)void 0===e[t].type&&(e[t].type="default");return e}function a(t){var i=e.innerWidth>0?e.innerWidth:screen.width;if(i>1100)return t;for(var r=0;r<t.length;r++){for(var o=[],a=0;a<t[r].sizes.length;a++)t[r].sizes[a][0]>i&&o.push(t[r].sizes[a]);t[r].sizes=n.difference(t[r].sizes,o)}return t}function d(){var e,n=[],o=i.get("clientType"),a=r();return t.each(a,function(t,i){void 0!==i.dynamic&&!0===i.dynamic&&(o&&o!==i.type||(n.push(i),e=i.localContext))}),{dynamicItems:n,localContext:e}}function g(e){for(var t={},n=r(),i=0;i<n.length;i++)if(n[i].id===e){t=n[i];break}return t}function u(e){var n=0;return t.each(e.sizes,function(e,t){0===n?n=t[1]:t[1]<n&&(n=t[1])}),n}function s(e){var n=0;return t.each(e.sizes,function(e,t){t[1]>n&&(n=t[1])}),n}function c(e,i){return t.each(e.sizes,function(t,r){if(r[1]<=i)return!0;e.sizes=n.removeByKey(e.sizes,t)}),e}function f(e){var n="default";return t.each(r(),function(t,i){return i.slot!==e||(n=i.type,!1)}),n}return{getInventory:r,getAdInfo:g,getDynamicInventory:d,shortestAvailable:u,tallestAvailable:s,limitUnitHeight:c,getUnitType:f}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("src/Manager",["jquery","./Config","./Inventory"],function(n,i,r){return t(e,n,i,r)}):"object"==typeof exports?module.exports=t(e,require("jquery"),require("./Config"),require("./Inventory")):(e.AdManager=e.AdManager||{},e.AdManager.Manager=t(e,e.jQuery,e.AdManager.Config,e.AdManager.Inventory))}(window,function(e,t,n,i){"use strict";function r(){n.get("enabled")&&(U=i.getInventory(),w=n.get("account"),o(),g())}function o(){t(document).on("AdManager:libraryLoaded",a).on("AdManager:runSequence",d).on("AdManager:slotsDefined",y).on("AdManager:refresh",q).on("AdManager:emptySlots",I).on("AdManager:emptySlotsInContext",b).on("AdManager:clearTargeting",l)}function a(){C=!0,s(),c(),n.get("autoload")&&t.event.trigger("AdManager:runSequence"),t.event.trigger("AdManager:ready")}function d(){z=[],f(),h(),p()}function g(){if(C)return u();var t,n;e.googletag=e.googletag||{},e.googletag.cmd=e.googletag.cmd||[],e.googletag.cmd.push(u),t=document.createElement("script"),t.async=!0,t.type="text/javascript",t.src="https://www.googletagservices.com/tag/js/gpt.js",n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}function u(){googletag.cmd.push(function(){t.event.trigger("AdManager:libraryLoaded")})}function s(){googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",m)})}function c(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad(),!0===n.get("lazy")&&googletag.pubads().enableLazyLoad(n.get("lazyConfig"))})}function f(){googletag.cmd.push(function(){var e=n.get("targeting");t.isEmptyObject(e)||t.each(e,function(e,t){googletag.pubads().setTargeting(e,t)})})}function l(){googletag.pubads().clearTargeting()}function h(){var e=n.get("clientType"),r=t(n.get("context")),o=S;!1!==e&&(o+='[data-client-type="'+e+'"]'),o+=":not(.is-disabled)",r.find(o).each(function(){var e=t(this).data("ad-id");"id"in i.getAdInfo(e)&&z.push(e)})}function p(){googletag.cmd.push(function(){var e=[];if(t.isEmptyObject(j))e=z;else{var r=t.map(j,function(e,t){return e.getSlotElementId()});e=t.grep(z,function(e,n){return-1===t.inArray(e,r)})}!0===n.get("usePlaceholders")?t.each(e,function(e,n){var r=i.getAdInfo(n),o=x(r.slot,"dfp");t.event.trigger("AdManager:adUnitRendered",{id:n,name:o})}):(t.each(e,function(e,n){var r=i.getAdInfo(n),o=x(r.slot,"dfp"),a=googletag.defineSlot(o,r.sizes,r.id);a.addService(googletag.pubads()),"targeting"in r&&!1===t.isEmptyObject(r.targeting)&&t.each(r.targeting,function(e,t){a.setTargeting(e,t)}),j.push(a)}),googletag.enableServices()),v(),t.event.trigger("AdManager:slotsDefined")})}function v(){var e=t(n.get("context")),r=[];r=t.grep(z,function(e,t){return null===document.getElementById(e)}),t.each(r,function(r,o){if(e.find('[data-ad-id="'+o+'"]').addClass("is-initialized").append(t("<div />",{id:o,addClass:"ad-unit-target"})),!0===n.get("usePlaceholders")){var a=i.getAdInfo(o);"object"==typeof a&&a.bidding_sizes&&a.bidding_sizes[0]&&$adLocation.find(".ad-unit-target").addClass("placeholder").css({width:a.bidding_sizes[0][0],height:a.bidding_sizes[0][1]})}})}function y(){t.event.trigger("AdManager:headerBidding"),googletag.cmd.push(function(){var e=t.grep(j,function(e,n){var i=e.getSlotElementId();return-1!==t.inArray(i,z)});t.each(z,function(e,t){googletag.display(t)}),googletag.pubads().refresh(e,{changeCorrelator:!1}),t.event.trigger("AdManager:requestSent")})}function m(e){var n=x(e.slot.getAdUnitPath(),"local");t.event.trigger("AdManager:adUnitRendered",{id:e.slot.getSlotElementId(),name:n,size:e.size,isEmpty:e.isEmpty,creativeId:e.creativeId,lineItemId:e.lineItemId,serviceName:e.serviceName})}function A(e){var n=null;return t.each(j,function(t,i){if(i.getSlotElementId()===e)return n=i,!1}),n}function M(e){googletag.cmd.push(function(){var n=A(e);googletag.display(e),googletag.pubads().refresh([n]),z=t.grep(z,function(t,n){return e!==t})})}function I(e,n){var i=t.map(n,function(e,t){return A(e)});googletag.pubads().clear(i),t.each(n,function(e,n){t(document.getElementById(n)).remove()})}function b(e,i){i=i||{},i=t.extend({$context:t(n.get("context")),removeContainer:!0},i);var r=i.$context.find(S),o=t.map(r,function(e,n){return A(t(e).data("ad-id"))});googletag.destroySlots(o),i.removeContainer?t(r).remove():t(r).empty()}function x(e,t){return"dfp"===t?"/"+w+"/"+e:e.replace("/"+w+"/","")}function q(e,n){n=n||j,n=t.map(n,function(e){return"string"==typeof e?A(e):e}),googletag.cmd.push(function(){googletag.pubads().refresh(n)})}var C=!1,j=[],z=[],U=[],w=null,S="[data-ad-unit]";return{init:r,displaySlot:M,runSequence:d,emptySlots:I,emptySlotsInContext:b,refresh:q}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("src/Insertion",["jquery","./Util","./Config","./Inventory"],t):"object"==typeof exports?module.exports=t(require("jquery"),require("./Util"),require("./Config"),require("./Inventory")):(e.AdManager=e.AdManager||{},e.AdManager.Insertion=t(e.jQuery,e.AdManager.Util,e.AdManager.Config,e.AdManager.Inventory))}(window,function(e,t,n,i){"use strict";function r(){e(document).on("AdManager:initSequence",a)}function o(){v=e(n.get("context"))}function a(){var e=i.getDynamicInventory();return A=e.dynamicItems,M=e.localContext,A.length?(o(),y=v.find(M).first(),y.length&&(m=!0),m?void g():d()):d()}function d(){e.event.trigger("AdManager:unitsInserted")}function g(){m&&(u(),f()),d()}function u(){var t=y.children(),i=n.get("insertion.insertExclusion");t.each(function(t){var r=e(this),o=!0;e.each(i,function(e,t){if(r.is(t)||r.find(t).length)return o=!1,!1}),t<n.get("insertion.childOffset")&&(o=!1),r.attr("data-valid-location",o)})}function s(e){return JSON.parse(e.data("valid-location"))}function c(t){var r=i.getAdInfo(t),o=e("<div />"),a=n.get("insertion.uniqueClass");return o.attr("data-ad-id",r.id).attr("data-ad-unit",r.slot).attr("data-client-type",r.type).addClass("in-content"),"string"==typeof a&&""!==a&&o.addClass(a),o}function f(){var t=n.get("insertion.pxBetweenUnits");e.each(A,function(e,n){var r=i.tallestAvailable(n),o=0===e,a=l({height:r+t,force:o});if(!a)return!1;var d=c(n.id);a.$insertBefore.before(d)})}function l(e){e=e||{};var t=p();if(!t.length)return!1;var n=new h({$nodes:t,force:e.force,height:e.height});return n.findLocation(),!!n.locationFound&&{$insertBefore:n.$insertBefore}}function h(e){this.$nodes=e.$nodes,this.validHeight=0,this.marginDifference=64,this.inserted=[],this.$insertBefore=null,this.locationFound=!1,this.exitLoop=!1,this.height=e.height,this.force=e.force,this.neededHeight=e.height+this.marginDifference,this.adUnitIndex=e.adUnitIndex}function p(){var e=y.find(I).last();return e.length?e.nextAll(y):y.children()}var v=null,y=null,m=!1,A=[],M=null,I="[data-ad-unit]";return h.prototype.findLocation=function(){var t=this;e.each(t.$nodes,function(n,i){return!0!==t.verifyNode(n,e(i))}),t.invalidateUsedNodes()},h.prototype.invalidateUsedNodes=function(){this.inserted.length&&e.each(this.inserted,function(t,n){e(n).data("valid-location",!1)})},h.prototype.verifyNode=function(e,t){var n=(t.outerHeight(!0)+t.outerHeight())/2,i=this.$nodes.length===e+1;return s(t)?(this.validHeight+=n,this.inserted.push(t)):(this.validHeight=0,this.inserted=[]),this.validHeight>=this.neededHeight||this.force&&i?(this.exitLoop=!0,0<this.inserted.length&&(this.$insertBefore=this.inserted[0],this.locationFound=!0)):i&&this.validHeight<this.neededHeight&&0<this.inserted.length&&(this.exitLoop=!0,this.validHeight>this.neededHeight/2&&(this.$insertBefore=this.inserted[0],this.locationFound=!0)),this.exitLoop},{init:r}}),function(e,t){"use strict";if("function"==typeof define&&define.amd)define("src/Index",["./Util","./Config","./Inventory","./Manager","./Insertion"],t);else if("object"==typeof exports)module.exports=t(require("./Util"),require("./Config"),require("./Inventory"),require("./Manager"),require("./Insertion"));else{var n=e.AdManager;e.AdManager=t(n.Util,n.Config,n.Inventory,n.Manager,n.Insertion)}}(window,function(e,t,n,i,r){"use strict";function o(e){if(!(e=e||!1))throw new Error("Please provide a config.");t.init(e),r.init(),i.init()}var a=o.prototype;return a.Util=e,a.Config=t,a.Inventory=n,a.Manager=i,a.Insertion=r,o});