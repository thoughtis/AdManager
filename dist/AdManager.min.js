/*!
 * admanager - A JavaScipt library for interacting with Google DFP.
 *
 * @author Athletics - http://athleticsnyc.com
 * @see https://github.com/athletics/AdManager
 * @version 0.6.4
 */

!function(e,n){"use strict";"function"==typeof define&&define.amd?define("src/Util",["jquery"],n):"object"==typeof exports?module.exports=n(require("jquery")):(e.AdManager=e.AdManager||{},e.AdManager.Util=n(e.jQuery))}(window,function(e){"use strict";function n(n,t){var i=[];return e.grep(n,function(n){-1===e.inArray(n,t)&&i.push(n)}),i}function t(n,t){return n=e.grep(n,function(e,n){return n!==t})}return{difference:n,removeByKey:t}}),function(e,n){"use strict";"function"==typeof define&&define.amd?define("src/Config",["jquery"],n):"object"==typeof exports?module.exports=n(require("jquery")):(e.AdManager=e.AdManager||{},e.AdManager.Config=n(e.jQuery))}(window,function(e){"use strict";function n(n){e(document).on("AdManager:importConfig",a),e.event.trigger("AdManager:importConfig",n)}function t(e,n){return r(u,e,n)}function i(e){return e=e||!1,e?o(u,e):u}function r(e,n,t){return"string"==typeof n&&(n=n.split(".")),n.length>1?r(e[n.shift()],n,t):e[n[0]]=t,e}function o(e,n){return"string"==typeof n&&(n=n.split(".")),n.length>1?o(e[n.shift()],n):n[0]in e?e[n[0]]:null}function a(n,t){return u=e.extend(d,u,t)}var u={},d={account:null,autoload:!0,clientType:!1,context:"body",enabled:!0,insertionEnabled:!1,insertion:{pxBetweenUnits:0,adHeightLimit:1e3,uniqueClass:"",insertExclusion:["img","iframe","video","audio",".video",".audio","[data-ad-unit]"]},inventory:[],targeting:[]};return{init:n,set:t,get:i}}),function(e,n){"use strict";"function"==typeof define&&define.amd?define("src/Inventory",["jquery","./Util","./Config"],function(t,i,r){return n(e,t,i,r)}):"object"==typeof exports?module.exports=n(e,require("jquery"),require("./Util"),require("./Config")):(e.AdManager=e.AdManager||{},e.AdManager.Inventory=n(e,e.jQuery,e.AdManager.Util,e.AdManager.Config))}(window,function(e,n,t,i){"use strict";function r(){return a(o(i.get("inventory")))}function o(e){for(var n=0;n<e.length;n++)"undefined"==typeof e[n].type&&(e[n].type="default");return e}function a(n){var i=e.innerWidth>0?e.innerWidth:screen.width;if(i>1100)return n;for(var r=0;r<n.length;r++){for(var o=[],a=0;a<n[r].sizes.length;a++)n[r].sizes[a][0]>i&&o.push(n[r].sizes[a]);n[r].sizes=t.difference(n[r].sizes,o)}return n}function u(){var e,t=[],o=i.get("clientType"),a=r();return n.each(a,function(n,i){"undefined"!=typeof i.dynamic&&i.dynamic===!0&&(o&&o!==i.type||(t.push(i),e=i.localContext))}),{dynamicItems:t,localContext:e}}function d(e){for(var n={},t=r(),i=0;i<t.length;i++)if(t[i].id===e){n=t[i];break}return n}function g(e){var t=0;return n.each(e.sizes,function(e,n){0===t?t=n[1]:n[1]<t&&(t=n[1])}),t}function s(e){var t=0;return n.each(e.sizes,function(e,n){n[1]>t&&(t=n[1])}),t}function c(e,i){return n.each(e.sizes,function(n,r){return r[1]<=i?!0:void(e.sizes=t.removeByKey(e.sizes,n))}),e}function f(e){var t="default";return n.each(r(),function(n,i){return i.slot!==e?!0:(t=i.type,!1)}),t}return{getInventory:r,getAdInfo:d,getDynamicInventory:u,shortestAvailable:g,tallestAvailable:s,limitUnitHeight:c,getUnitType:f}}),function(e,n){"use strict";"function"==typeof define&&define.amd?define("src/Manager",["jquery","./Config","./Inventory"],function(t,i,r){return n(e,t,i,r)}):"object"==typeof exports?module.exports=n(e,require("jquery"),require("./Config"),require("./Inventory")):(e.AdManager=e.AdManager||{},e.AdManager.Manager=n(e,e.jQuery,e.AdManager.Config,e.AdManager.Inventory))}(window,function(e,n,t,i){"use strict";function r(){t.get("enabled")&&(U=i.getInventory(),w=t.get("account"),o(),d())}function o(){n(document).on("AdManager:libraryLoaded",a).on("AdManager:runSequence",u).on("AdManager:slotsDefined",v).on("AdManager:refresh",b).on("AdManager:emptySlots",M).on("AdManager:emptySlotsInContext",I)}function a(){q=!0,s(),c(),t.get("autoload")&&n.event.trigger("AdManager:runSequence"),n.event.trigger("AdManager:ready")}function u(){j=[],f(),l(),p()}function d(){if(q)return g();var n,t,i;e.googletag=e.googletag||{},e.googletag.cmd=e.googletag.cmd||[],n.cmd.push(g),t=document.createElement("script"),t.async=!0,t.type="text/javascript",t.src="https://www.googletagservices.com/tag/js/gpt.js",i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(t,i)}function g(){googletag.cmd.push(function(){n.event.trigger("AdManager:libraryLoaded")})}function s(){googletag.cmd.push(function(){googletag.pubads().addEventListener("slotRenderEnded",y)})}function c(){googletag.cmd.push(function(){googletag.pubads().collapseEmptyDivs(),googletag.pubads().enableSingleRequest(),googletag.pubads().disableInitialLoad()})}function f(){googletag.cmd.push(function(){var e=t.get("targeting");n.isEmptyObject(e)||n.each(e,function(e,n){googletag.pubads().setTargeting(e,n)})})}function l(){var e=t.get("clientType"),r=n(t.get("context")),o=E;e!==!1&&(o+='[data-client-type="'+e+'"]'),o+=":not(.is-disabled)",r.find(o).each(function(){var e=n(this).data("ad-id"),t=i.getAdInfo(e);"id"in t&&j.push(e)})}function p(){googletag.cmd.push(function(){var e=[];if(n.isEmptyObject(C))e=j;else{var t=n.map(C,function(e,n){return e.getSlotElementId()});e=n.grep(j,function(e,i){return-1!==n.inArray(e,t)?!1:!0})}n.each(e,function(e,t){var r=i.getAdInfo(t),o=x(r.slot,"dfp"),a=googletag.defineSlot(o,r.sizes,r.id);a.addService(googletag.pubads()),"targeting"in r&&!1===n.isEmptyObject(r.targeting)&&n.each(r.targeting,function(e,n){a.setTargeting(e,n)}),C.push(a)}),googletag.enableServices(),h(),n.event.trigger("AdManager:slotsDefined")})}function h(){var e=n(t.get("context")),i=[];i=n.grep(j,function(e,n){return null===document.getElementById(e)}),n.each(i,function(t,i){e.find('[data-ad-id="'+i+'"]').addClass("is-initialized").append(n("<div />",{id:i,addClass:"ad-unit-target"}))})}function v(){n.event.trigger("AdManager:headerBidding"),googletag.cmd.push(function(){var e=n.grep(C,function(e,t){var i=e.getSlotElementId();return-1!==n.inArray(i,j)});n.each(j,function(e,n){googletag.display(n)}),googletag.pubads().refresh(e,{changeCorrelator:!1}),n.event.trigger("AdManager:requestSent")})}function y(e){var t=x(e.slot.getAdUnitPath(),"local");n.event.trigger("AdManager:adUnitRendered",{name:t,size:e.size,isEmpty:e.isEmpty,creativeId:e.creativeId,lineItemId:e.lineItemId,serviceName:e.serviceName})}function m(e){var t=null;return n.each(C,function(n,i){var r=i.getSlotElementId();return r===e?(t=i,!1):void 0}),t}function A(e){googletag.cmd.push(function(){var t=m(e);googletag.display(e),googletag.pubads().refresh([t]),j=n.grep(j,function(n,t){return e!==n})})}function M(e,t){var i=n.map(t,function(e,n){return m(e)});googletag.pubads().clear(i),n.each(t,function(e,t){n(document.getElementById(t)).remove()})}function I(e,i){i=i||{},i=n.extend({$context:n(t.get("context")),removeContainer:!0},i);var r=i.$context.find(E),o=n.map(r,function(e,t){return m(n(e).data("ad-id"))});googletag.pubads().clear(o),i.removeContainer?n(r).remove():n(r).empty()}function x(e,n){return"dfp"===n?"/"+w+"/"+e:e.replace("/"+w+"/","")}function b(e,n){n=n||C,googletag.cmd.push(function(){googletag.pubads().refresh(n)})}var q=!1,C=[],j=[],U=[],w=null,E="[data-ad-unit]";return{init:r,displaySlot:A,runSequence:u,emptySlots:M,emptySlotsInContext:I,refresh:b}}),function(e,n){"use strict";"function"==typeof define&&define.amd?define("src/Insertion",["jquery","./Util","./Config","./Inventory"],n):"object"==typeof exports?module.exports=n(require("jquery"),require("./Util"),require("./Config"),require("./Inventory")):(e.AdManager=e.AdManager||{},e.AdManager.Insertion=n(e.jQuery,e.AdManager.Util,e.AdManager.Config,e.AdManager.Inventory))}(window,function(e,n,t,i){"use strict";function r(){e(document).on("AdManager:initSequence",a)}function o(){v=e(t.get("context"))}function a(){var e=i.getDynamicInventory();return A=A.length?A:e.dynamicItems,M=M?M:e.localContext,A.length?(o(),y=v.find(M).first(),y.length&&(m=!0),m?void d():u()):u()}function u(){e.event.trigger("AdManager:unitsInserted")}function d(){m&&(g(),f()),u()}function g(){var n=y.children(),i=t.get("insertion.insertExclusion");n.each(function(n){var t=e(this),r=!0;e.each(i,function(e,n){return t.is(n)||t.find(n).length?(r=!1,!1):void 0}),t.attr("data-valid-location",r)})}function s(e){return JSON.parse(e.data("valid-location"))}function c(n){var r=i.getAdInfo(n),o=e("<div />"),a=t.get("insertion.uniqueClass");return o.attr("data-ad-id",r.id).attr("data-ad-unit",r.slot).attr("data-client-type",r.type).addClass("in-content"),"string"==typeof a&&""!==a&&o.addClass(a),o}function f(){var n=t.get("insertion.pxBetweenUnits");e.each(A,function(e,t){var r=i.tallestAvailable(t),o=0===e,a=l({height:r+n,force:o});if(!a)return!1;var u=c(t.id);a.$insertBefore.before(u)})}function l(e){e=e||{};var n=h();if(!n.length)return!1;var t=new p({$nodes:n,force:e.force,height:e.height});return t.findLocation(),t.locationFound?{$insertBefore:t.$insertBefore}:!1}function p(e){this.$nodes=e.$nodes,this.validHeight=0,this.marginDifference=64,this.inserted=[],this.$insertBefore=null,this.locationFound=!1,this.exitLoop=!1,this.height=e.height,this.force=e.force,this.neededHeight=e.height+this.marginDifference,this.adUnitIndex=e.adUnitIndex}function h(){var e=y.find(I).last(),n=null;return n=e.length?e.nextAll(y):y.children()}var v=null,y=null,m=!1,A=[],M=null,I="[data-ad-unit]";return p.prototype.findLocation=function(){var n=this;e.each(n.$nodes,function(t,i){return!0!==n.verifyNode(t,e(i))?!0:!1}),n.invalidateUsedNodes()},p.prototype.invalidateUsedNodes=function(){this.inserted.length&&e.each(this.inserted,function(n,t){e(t).data("valid-location",!1)})},p.prototype.verifyNode=function(e,n){var t=(n.outerHeight(!0)+n.outerHeight())/2,i=this.$nodes.length===e+1;return s(n)?(this.validHeight+=t,this.inserted.push(n)):(this.validHeight=0,this.inserted=[]),(this.validHeight>=this.neededHeight||this.force&&i)&&(this.exitLoop=!0,0<this.inserted.length&&(this.$insertBefore=this.inserted[0],this.locationFound=!0)),this.exitLoop},{init:r}}),function(e,n){"use strict";if("function"==typeof define&&define.amd)define("src/Index",["./Util","./Config","./Inventory","./Manager","./Insertion"],n);else if("object"==typeof exports)module.exports=n(require("./Util"),require("./Config"),require("./Inventory"),require("./Manager"),require("./Insertion"));else{var t=e.AdManager;e.AdManager=n(t.Util,t.Config,t.Inventory,t.Manager,t.Insertion)}}(window,function(e,n,t,i,r){"use strict";function o(e){if(e=e||!1,!e)throw new Error("Please provide a config.");n.init(e),r.init(),i.init()}var a=o.prototype;return a.Util=e,a.Config=n,a.Inventory=t,a.Manager=i,a.Insertion=r,o});